<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Trade Algo Bot — Signal</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: -apple-system, "SF Pro Text", "Inter", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background: linear-gradient(180deg,#060718 0%, #040417 45%, #02030a 100%);
    color:#e6eef8;
    min-height:100vh;
    display:flex;align-items:center;justify-content:center;padding:10px;
  }

  .app{ width:100%; max-width:420px; background: linear-gradient(180deg, rgba(6,12,28,0.98), rgba(9,10,20,0.99)); border-radius:18px; box-shadow:0 30px 60px rgba(2,3,10,0.7); padding:18px; border:1px solid rgba(255,255,255,0.02); }

  .heading { text-align:center; font-weight:700; font-size:16px; margin-bottom:10px; color:#fff;}
  .subtext{ text-align:center;color:rgba(230,238,248,0.65); font-size:12px; margin-bottom:14px; }

  .card { background:#0a0d1d; border-radius:16px; border:1px solid #1a1f35; padding:16px; text-align:center; position:relative; }

  .pair-row { display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom:8px; }
  .pair-flag { width:34px; height:24px; border-radius:6px; overflow:hidden; display:inline-block; border:1px solid rgba(255,255,255,0.03); box-shadow:0 8px 18px rgba(2,4,10,0.35); }
  .pair-title{ font-weight:800; font-size:16px; margin-bottom:6px; display:flex; align-items:center; gap:8px; justify-content:center; }
  .pair-meta{ font-size:12px; color:#7a86a8; margin-bottom:12px; opacity:0.95 }

  /* progress ring */
  .ring { width:120px;height:120px;border-radius:50%;margin:0 auto;display:flex;align-items:center;justify-content:center; position:relative; }
  .ring .percent{ font-weight:800; font-size:20px; color:#b06bff; z-index:2; }
  .ring svg{ position:absolute; left:0; top:0; transform:rotate(-90deg); }

  .indicators{ display:flex; gap:10px; justify-content:center; margin-top:14px; margin-bottom:16px; }
  .ind-chip{ padding:8px 12px; border-radius:12px; background:#0a0d1d; border:1px solid #1a1f35; color:#fff; font-weight:700; font-size:12px; }

  .btn-primary{ width:100%; padding:14px; border-radius:14px; border:none; font-weight:800; font-size:15px; color:#fff; cursor:pointer; background:linear-gradient(90deg,#5f2bff,#9a4dff); margin-bottom:12px; box-shadow: 0 6px 18px rgba(95,43,255,0.12); }
  .btn-ghost{ width:100%; padding:14px; border-radius:14px; border:1px solid #1a1f35; font-weight:700; font-size:15px; color:#7a86a8; background:transparent; cursor:pointer; }

  .powered{ text-align:center; font-size:11px; color:#5b6280; margin-top:10px; }

  /* subscription modal */
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75); backdrop-filter: blur(4px); justify-content:center; align-items:center; z-index:9999; }
  .modal .box{ background:#0b0f1e; color:#fff; padding:22px; border-radius:16px; width:92%; max-width:420px; border:1px solid #1f263b; text-align:center; box-shadow: 0 30px 60px rgba(2,3,10,0.7); }
  .modal h3{ font-size:20px; margin-bottom:8px; }
  .modal p{ color:#9aa4bd; font-size:14px; margin-bottom:14px; line-height:1.45; }
  .modal .actions{ display:flex; gap:10px; justify-content:center; margin-top:8px; }
  .modal .actions a, .modal .actions button{ flex:1; padding:12px 10px; border-radius:12px; text-decoration:none; border:none; font-weight:800; cursor:pointer; }
  .modal .actions .tg{ background:linear-gradient(90deg,#5f2bff,#9a4dff); color:#fff; }
  .modal .actions .check{ background:#0a0f15; color:#9ff0c7; border:1px solid rgba(255,255,255,0.03); }

  /* pending screen inside modal */
  .pending-box { margin-top:12px; padding:14px; border-radius:12px; background: linear-gradient(180deg,#071028,#071022); border:1px solid rgba(255,255,255,0.02); color:#c8d2e6; text-align:left }
  .pending-box p{ margin:0 0 8px 0; color:#9aa4bd; font-size:13px }
  .pending-wait { display:flex; gap:10px; align-items:center; margin-top:8px; }
  .pending-wait .dot { width:12px;height:12px;border-radius:999px;background:#6ee7b7; box-shadow: 0 6px 18px rgba(110,231,183,0.08) }
  .pending-note { color:#9aa4bd; font-size:13px; }

  .disabled { opacity:0.55; pointer-events:none; }

  /* SIGNAL CARD - TIKTOK STYLE */
  .signal-card {
    margin: 14px auto 6px;
    width: 86%;
    max-width:320px;
    background: linear-gradient(180deg, rgba(22,12,48,0.9), rgba(12,8,30,0.72));
    border-radius:16px;
    padding: 18px;
    border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 12px 30px rgba(40,18,140,0.14), inset 0 1px 0 rgba(255,255,255,0.02);
    position:relative;
  }
  .arrow-wrap { height:120px; display:flex; align-items:center; justify-content:center; }
  .arrow {
    width:120px;
    height:80px;
    display:block;
    filter: drop-shadow(0 6px 18px rgba(0,0,0,0.5));
    transition: transform 500ms ease, opacity 300ms ease;
    opacity:0;
    transform: translateY(12px) scale(0.95);
  }
  .arrow.up { opacity:0; }
  .signal-text {
    text-align:center; margin-top:8px; font-weight:800; font-size:18px;
  }
  .signal-up { color:#34D399; } /* green */
  .signal-down { color:#ff4d6d; } /* red */

  /* small animation pulse */
  .pulse {
    position:absolute; right:12px; top:12px; width:64px; height:64px; border-radius:12px;
    background: radial-gradient(circle at 20% 20%, rgba(90,60,255,0.14), transparent 30%);
    box-shadow: 0 10px 30px rgba(90,60,255,0.08);
  }

  @media (min-width:520px) {
    .modal .box { max-width:520px; }
  }

</style>
</head>
<body>
  <div class="app" role="application">
    <div class="heading">Advanced Trading Signals</div>
    <div class="subtext">Pairs · Time · Signal</div>

    <div class="card" id="mainCard">
      <div class="pair-row">
        <div class="pair-flag" id="flag1Wrap"><img id="flag1Img" src="" alt="" style="width:100%;height:100%;object-fit:cover"></div>
        <div class="pair-title" id="pairTitle">EUR / USD (OTC)</div>
        <div class="pair-flag" id="flag2Wrap"><img id="flag2Img" src="" alt="" style="width:100%;height:100%;object-fit:cover"></div>
      </div>

      <div class="pair-meta" id="pairMeta">Live Signal · 5s Frame</div>

      <!-- SIGNAL CARD -->
      <div class="signal-card" aria-hidden="false" id="signalCard">
        <div class="pulse" aria-hidden="true"></div>
        <div class="arrow-wrap">
          <!-- SVG arrows: we'll toggle visibility via classes -->
          <svg id="arrowUp" class="arrow up" viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 40 L40 15 L60 35 L90 5" stroke="#34D399" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none" />
            <path d="M88 7 L95 12 L82 14" stroke="#34D399" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" fill="none" />
          </svg>

          <svg id="arrowDown" class="arrow down" viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 10 L40 35 L60 15 L90 55" stroke="#ff4d6d" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none" />
            <path d="M88 53 L95 48 L82 46" stroke="#ff4d6d" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" fill="none" />
          </svg>
        </div>

        <div id="signalText" class="signal-text"><span class="signal-up">Your signal: —</span></div>
      </div>

      <div style="margin-top:12px;color:#8a94ad;font-size:13px">Analyzing signal…</div>
      <div style="margin-top:4px;color:#58607a;font-size:12px">Processing market data</div>

      <div class="indicators">
        <div class="ind-chip">Parabolic SAR</div>
        <div class="ind-chip">On Balance Volume</div>
      </div>

      <button class="btn-primary" id="generateBtn">⚡ Generate New Signal</button>
      <button class="btn-ghost" id="backBtn">← Back to Pairs</button>

      <div class="powered">Powered by Advanced AI</div>
    </div>
  </div>

  <!-- subscription modal (kept unchanged) -->
  <div class="modal" id="subModal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="box" id="modalBox">
      <h3 id="modalTitle">Subscription Required</h3>
      <p id="modalText">
        To generate live AI trading signals you must activate a subscription through our official Telegram bot. Subscribing gives you verified access to real-time signals, push notifications, and automated trade execution options.
      </p>

      <div class="actions" id="modalActions">
        <a class="tg" id="tgLink" href="https://t.me/Trade_Algo_Robot?start=tradealgo_sub" target="_blank" rel="noopener noreferrer">Open Telegram Bot</a>
        <button class="check" id="iSubscribedBtn">I Subscribed</button>
      </div>

      <div id="pendingArea" style="display:none">
        <div class="pending-box">
          <p><strong>Upload proof of payment inside our Telegram bot.</strong></p>
          <p class="pending-note">After you send the screenshot or receipt in Telegram, our support will verify the payment and activate your access instantly. This page will unlock when verification is complete.</p>

          <div class="pending-wait">
            <div style="flex:1">
              <button id="tgLink2" class="tg" style="width:100%;padding:12px 10px;border-radius:12px;text-decoration:none;border:none;font-weight:800;cursor:pointer;background:linear-gradient(90deg,#5f2bff,#9a4dff);color:#fff;">Open Telegram Bot</button>
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <button id="waitingBtn" class="btn-ghost disabled" style="flex:1">Waiting for verification…</button>
            <button id="cancelPending" class="btn-ghost" style="flex:1">Cancel</button>
          </div>

          <p style="margin-top:10px;color:#7a86a8;font-size:12px">If you are verified by Telegram support they can either redirect you back to this page with <code>?verified=1</code> or activate your account server-side. This demo requires the bot to mark the user as verified.</p>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){

  // helper to read querystring
  function qs(name){ return new URLSearchParams(location.search).get(name); }

  // --- read incoming params (pair and flags forwarded from timeframe) ---
  const rawPair = qs('pair') || 'EURUSD';
  const tf = qs('tf') || '5s';
  const flag1 = qs('flag1') || ''; // e.g. 'eu'
  const flag2 = qs('flag2') || ''; // e.g. 'us'

  // -- UI elements --
  const pairTitleEl = document.getElementById('pairTitle');
  const pairMetaEl = document.getElementById('pairMeta');
  const flag1Img = document.getElementById('flag1Img');
  const flag2Img = document.getElementById('flag2Img');
  const generateBtn = document.getElementById('generateBtn');
  const backBtn = document.getElementById('backBtn');
  const subModal = document.getElementById('subModal');
  const iSubBtn = document.getElementById('iSubscribedBtn');
  const tgLink = document.getElementById('tgLink');
  const tgLink2 = document.getElementById('tgLink2');
  const modalActions = document.getElementById('modalActions');
  const pendingArea = document.getElementById('pendingArea');
  const waitingBtn = document.getElementById('waitingBtn');
  const cancelPending = document.getElementById('cancelPending');

  const arrowUp = document.getElementById('arrowUp');
  const arrowDown = document.getElementById('arrowDown');
  const signalText = document.getElementById('signalText');

  // --- utility: flag url builder using flagcdn style ---
  function flagUrl(code, size){
    if(!code) return '';
    // flagcdn uses 2-letter country codes; your pair uses codes above (eu, gb, us, jp etc)
    // we use the same pattern seen in index.html: https://flagcdn.com/w40/xx.png
    return `https://flagcdn.com/w${size}/${code}.png`;
  }

  // --- format pair (EURUSD -> EUR / USD) ---
  function formatPair(p){
    if(!p) return p;
    if(p.length === 6){
      return p.slice(0,3) + ' / ' + p.slice(3);
    }
    return p;
  }

  // --- apply incoming params to UI ---
  pairTitleEl.textContent = `${formatPair(rawPair)} (OTC)`;
  pairMetaEl.textContent = `Live Signal · ${tf} Frame`;

  // set flags if provided (fallback to hidden if not)
  if(flag1){
    flag1Img.src = flagUrl(flag1,40);
    flag1Img.alt = flag1;
    document.getElementById('flag1Wrap').style.display = 'inline-block';
  } else {
    document.getElementById('flag1Wrap').style.display = 'none';
  }
  if(flag2){
    flag2Img.src = flagUrl(flag2,40);
    flag2Img.alt = flag2;
    document.getElementById('flag2Wrap').style.display = 'inline-block';
  } else {
    document.getElementById('flag2Wrap').style.display = 'none';
  }

  // --- Admin override: only admin can generate signals without subscription ---
  // To enable locally: in browser console run:
  // localStorage.setItem('tradealgo_admin','1')
  // OR open dashboard.html?admin=1 once.
  function isAdmin(){
    if(qs('admin') === '1') {
      try { localStorage.setItem('tradealgo_admin','1'); } catch(e) {}
      return true;
    }
    return localStorage.getItem('tradealgo_admin') === '1';
  }

  // Verified subscription check (your existing flow)
  function isVerified(){
    return localStorage.getItem('tradealgo_verified') === '1';
  }

  // preserve existing pending/subscribed flow
  function isPending(){
    return localStorage.getItem('tradealgo_subscribed') === 'pending';
  }

  // When admin — bypass modal and allow generating
  function canGenerate(){
    return isAdmin() || isVerified();
  }

  // --- SIGNAL GENERATION: animate arrow and show up/down text inside the dashboard ---
  function showSignal(direction){
    // hide both first
    arrowUp.style.opacity = 0; arrowUp.style.transform = 'translateY(12px) scale(0.95)';
    arrowDown.style.opacity = 0; arrowDown.style.transform = 'translateY(12px) scale(0.95)';
    signalText.innerHTML = '';

    if(direction === 'UP'){
      arrowUp.style.opacity = 1; arrowUp.style.transform = 'translateY(0px) scale(1)';
      signalText.innerHTML = `<span class="signal-up">Your signal: UP</span>`;
    } else {
      arrowDown.style.opacity = 1; arrowDown.style.transform = 'translateY(0px) scale(1)';
      signalText.innerHTML = `<span class="signal-down">Your signal: DOWN</span>`;
    }

    // small auto-reset after a while (keeps it visible for 4s)
    setTimeout(()=>{
      arrowUp.style.opacity = 0; arrowUp.style.transform = 'translateY(12px) scale(0.95)';
      arrowDown.style.opacity = 0; arrowDown.style.transform = 'translateY(12px) scale(0.95)';
      signalText.innerHTML = `<span class="signal-up">Your signal: —</span>`;
    }, 4000);
  }

  // Fake signal decision (simple RNG + ensure repeatable feel)
  function generateSignalDecision(){
    // deterministic-ish using current seconds and pair to add variety
    try {
      const seed = (new Date()).getSeconds() + rawPair.length;
      const r = (seed * 9301 + 49297) % 233280;
      return (r % 2 === 0) ? 'UP' : 'DOWN';
    } catch(e){
      return (Math.random() > 0.5) ? 'UP' : 'DOWN';
    }
  }

  // apply initial UI state
  if(isVerified() || isAdmin()){
    // if verified/admin, do nothing special — Generate will work normally
  } else {
    // for non-verified users we keep normal UI (Generate opens modal)
  }

  // Generate button behavior
  generateBtn.addEventListener('click', ()=>{
    if(canGenerate()){
      // admin or verified -> generate and animate inside dashboard
      generateBtn.disabled = true;
      generateBtn.textContent = 'Generating...';
      setTimeout(()=>{
        const decision = generateSignalDecision();
        showSignal(decision);
        generateBtn.textContent = '⚡ Generate New Signal';
        generateBtn.disabled = false;
        // optionally store last generated signal locally (for debug)
        try { localStorage.setItem('tradealgo_last_signal', JSON.stringify({pair:rawPair,tf:tf,signal:decision,ts:Date.now()})); } catch(e){}
      }, 900);
      return;
    }

    // Not verified & not admin -> show subscription modal
    openSubscriptionModal();
  });

  // Back button
  backBtn.addEventListener('click', ()=> { window.location.href = 'index.html'; });

  // Existing subscription modal logic (kept mostly intact)
  // I Subscribed clicked -> switch to pending UI (no unlock)
  function openSubscriptionModal(){
    subModal.style.display = 'flex';
    subModal.setAttribute('aria-hidden','false');
    // reset to initial view
    modalActions.style.display = 'flex';
    pendingArea.style.display = 'none';
    waitingBtn.classList.add('disabled');
  }

  iSubBtn.addEventListener('click', ()=>{
    try { localStorage.setItem('tradealgo_subscribed','pending'); } catch(e){}
    modalActions.style.display = 'none';
    pendingArea.style.display = 'block';
    waitingBtn.classList.add('disabled');
  });

  tgLink2.addEventListener('click', ()=>{ window.open('https://t.me/Trade_Algo_Robot?start=tradealgo_sub','_blank','noopener'); });

  cancelPending.addEventListener('click', ()=>{
    try { localStorage.removeItem('tradealgo_subscribed'); } catch(e){}
    pendingArea.style.display = 'none';
    modalActions.style.display = 'flex';
    subModal.style.display = 'none';
    subModal.setAttribute('aria-hidden','true');
  });

  subModal.addEventListener('click', (e)=>{
    if(e.target === subModal){
      subModal.style.display = 'none';
      subModal.setAttribute('aria-hidden','true');
    }
  });

  // Poll for verification state in localStorage so page can update if bot marks user verified.
  let pollTimer = setInterval(()=>{
    if(isVerified()){
      waitingBtn.classList.remove('disabled');
      waitingBtn.textContent = 'Verified — Ready';
      if(subModal.style.display === 'flex'){
        setTimeout(()=>{ subModal.style.display='none'; subModal.setAttribute('aria-hidden','true'); }, 700);
      }
    }
  }, 1200);

  window.addEventListener('beforeunload', ()=> clearInterval(pollTimer) );

  // initialize progress ring (same behavior as before, non-blocking)
  (function(){
    const circle = document.getElementById('progressCircle');
    const percentText = document.getElementById('percentText');
    if(!circle || !percentText) return;
    const radius = 52;
    const circumference = 2 * Math.PI * radius;
    circle.style.strokeDasharray = `${circumference}`;
    let pct = 0;
    const interval = setInterval(()=>{
      if(pct >= 73) { clearInterval(interval); return; }
      pct += Math.floor(Math.random()*6)+2;
      if(pct > 73) pct = 73;
      const off = circumference * (1 - pct / 100);
      circle.style.transition = 'stroke-dashoffset 0.35s ease';
      circle.style.strokeDashoffset = off;
      percentText.textContent = pct + '%';
    }, 400);
    setTimeout(()=>{ if(percentText) percentText.textContent = '73%'; if(circle) circle.style.strokeDashoffset = circumference * (1 - 73/100); }, 4100);
  })();

})();
</script>
</body>
</html>
