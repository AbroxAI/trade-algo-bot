<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Trade Algo Bot — Signal</title>
<style>
  /* Reuse the exact same styles as dashboard for consistent replica */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#060718 0%, #040417 45%, #02030a 100%);
    color:#e6eef8;
    min-height:100vh;
    display:flex;align-items:center;justify-content:center;padding:12px;
  }
  .app{ width:100%; max-width:520px; background: linear-gradient(180deg, rgba(6,12,28,0.98), rgba(9,10,20,0.99)); border-radius:18px; box-shadow:0 30px 60px rgba(2,3,10,0.7); padding:18px; border:1px solid rgba(255,255,255,0.02); position:relative; }
  .heading { text-align:center; font-weight:800; font-size:16px; margin-bottom:8px; color:#fff;}
  .subtext{ text-align:center;color:rgba(230,238,248,0.62); font-size:12px; margin-bottom:12px; }
  .card { background:#0a0d1d; border-radius:16px; border:1px solid #1a1f35; padding:16px; text-align:center; position:relative; }
  .pair-row { display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom:8px; }
  .pair-flag { width:36px; height:26px; border-radius:6px; overflow:hidden; display:inline-flex; align-items:center; justify-content:center; font-weight:800; font-size:11px; }
  .pair-title{ font-weight:800; font-size:16px; margin-bottom:4px; display:flex; align-items:center; gap:8px; justify-content:center; color:#f3f6fb }
  .pair-meta{ font-size:12px; color:#7a86a8; margin-bottom:12px; opacity:0.95 }
  .ring { width:132px;height:132px;border-radius:50%;margin:6px auto 8px;display:flex;align-items:center;justify-content:center; position:relative; }
  .ring .percent{ font-weight:800; font-size:20px; color:#b06bff; z-index:3; text-shadow:0 2px 8px rgba(176,107,255,0.15) }
  .indicators{ display:flex; gap:8px; justify-content:center; margin-top:10px; margin-bottom:14px; flex-wrap:wrap }
  .ind-chip{ padding:8px 12px; border-radius:999px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.03); color:#fff; font-weight:700; font-size:12px; cursor:pointer; box-shadow: 0 8px 18px rgba(2,4,10,0.35); }
  .btn-primary{ width:100%; padding:14px; border-radius:14px; border:none; font-weight:800; font-size:15px; color:#fff; cursor:pointer; background:linear-gradient(90deg,#5f2bff,#9a4dff); margin-bottom:10px; box-shadow: 0 6px 18px rgba(95,43,255,0.12); }
  .btn-ghost{ width:100%; padding:12px; border-radius:12px; border:1px solid #1a1f35; font-weight:700; font-size:14px; color:#7a86a8; background:transparent; cursor:pointer; }
  .arrow-overlay { position:absolute; left:50%; top:172px; transform:translateX(-50%); width:220px; height:120px; display:flex; align-items:center; justify-content:center; pointer-events:none; opacity:0; transition: opacity 260ms ease, transform 480ms cubic-bezier(.2,.9,.36,1); z-index:6; }
  .arrow-overlay.show { opacity:1; transform:translateX(-50%) translateY(-8px); }
  .glow-halo { position:absolute; inset:auto; width:220px; height:120px; left:50%; top:168px; transform:translateX(-50%) scale(0.9); border-radius:20px; pointer-events:none; z-index:4; opacity:0; mix-blend-mode:screen; }
  .glow-halo.up { background: radial-gradient(closest-side, rgba(52,211,153,0.14), rgba(52,211,153,0.03) 40%, transparent 55%); animation: haloUp 1500ms ease-in-out 1; }
  .glow-halo.down { background: radial-gradient(closest-side, rgba(255,77,109,0.14), rgba(255,77,109,0.03) 40%, transparent 55%); animation: haloDown 1500ms ease-in-out 1; }
  .glow-halo.show { opacity:1; }
  @keyframes haloUp { 0%{transform:translateX(-50%) scale(0.9); opacity:0} 20%{opacity:0.9; transform:translateX(-50%) scale(1.06)} 100%{opacity:0.12; transform:translateX(-50%) scale(1.12)} }
  @keyframes haloDown { 0%{transform:translateX(-50%) scale(0.9); opacity:0} 20%{opacity:0.9; transform:translateX(-50%) scale(1.06)} 100%{opacity:0.12; transform:translateX(-50%) scale(1.12)} }
  .signal-label { margin-top:8px; font-weight:900; font-size:14px; padding:6px 12px; border-radius:999px; text-transform:uppercase; letter-spacing:0.6px; box-shadow: 0 8px 36px rgba(0,0,0,0.45); opacity:0; transform:translateY(6px); transition: opacity 260ms ease, transform 360ms cubic-bezier(.2,.9,.36,1); z-index:7; pointer-events:none; }
  .signal-label.show { opacity:1; transform:translateY(0); }
  .signal-up { background: linear-gradient(90deg,#0f7f4a,#34d399); color: #032614; text-shadow: 0 2px 8px rgba(52,211,153,0.12);}
  .signal-down { background: linear-gradient(90deg,#ff6b7a,#ff4d6d); color: #3a0610; text-shadow: 0 2px 8px rgba(255,77,109,0.12); }
  .modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75); backdrop-filter: blur(4px); justify-content:center; align-items:center; z-index:9999; }
  .modal .box{ background:#0b0f1e; color:#fff; padding:22px; border-radius:16px; width:92%; max-width:420px; border:1px solid #1f263b; text-align:center; box-shadow: 0 30px 60px rgba(2,3,10,0.7); }
  .tg{ flex:1; padding:12px; border-radius:12px; text-decoration:none; background:linear-gradient(90deg,#5f2bff,#9a4dff); color:#fff; font-weight:800; }
  .check{ flex:1; padding:12px; border-radius:12px; background:#0a0f15; color:#9ff0c7; border:1px solid rgba(255,255,255,0.03); font-weight:800; }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Signal view">
    <div class="heading">Signal View</div>
    <div class="subtext">Pairs · Time · Signal</div>

    <div class="card">
      <div class="pair-row">
        <div class="pair-flag" id="flag1Wrap">EU</div>
        <div style="display:flex;flex-direction:column;align-items:center">
          <div class="pair-title" id="pairTitle">EUR / USD (OTC)</div>
          <div class="pair-meta" id="pairMeta">Live Signal · <span id="tfText">5s</span> Frame</div>
        </div>
        <div class="pair-flag" id="flag2Wrap">US</div>
      </div>

      <div class="ring">
        <svg width="132" height="132" viewBox="0 0 132 132">
          <circle cx="66" cy="66" r="56" stroke="#22263b" stroke-width="10" fill="none"></circle>
          <circle id="progressCircle" cx="66" cy="66" r="56" stroke="#b06bff" stroke-width="10" stroke-linecap="round" fill="none" stroke-dasharray="351.858" stroke-dashoffset="351.858"></circle>
        </svg>
        <div class="percent" id="ringPercent">--%</div>
      </div>

      <div id="processingText" style="margin-top:10px;color:#8a94ad;font-size:13px">Analyzing signal…</div>
      <div style="margin-top:4px;color:#58607a;font-size:12px">Processing market data</div>

      <div class="indicators" id="indicatorsList"></div>

      <button class="btn-primary" id="generateBtn">⚡ Generate New Signal</button>
      <button class="btn-ghost" id="backBtn">← Back to Dashboard</button>

      <div id="glowHalo" class="glow-halo"></div>
      <div class="arrow-overlay" id="arrowOverlay"><div id="arrowUp" style="display:none"><svg viewBox="0 0 140 90" width="160" height="82"><path d="M12 60 L55 18 L85 46 L128 8" stroke="#34D399" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" fill="none" /></svg></div><div id="arrowDown" style="display:none"><svg viewBox="0 0 140 90" width="160" height="82"><path d="M12 18 L55 60 L85 30 L128 72" stroke="#ff5b74" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" fill="none" /></svg></div></div>
      <div id="signalLabel" class="signal-label"></div>

    </div>
  </div>

  <!-- subscription modal (same) -->
  <div class="modal" id="subModal"><div class="box"><h3>Subscription Required</h3><p>To generate live AI trading signals you must activate a subscription through our official Telegram bot.</p><div style="display:flex;gap:8px"><a class="tg" href="https://t.me/Trade_Algo_Robot?start=tradealgo_sub" target="_blank">Open Telegram Bot</a><button id="iSubscribedBtn" class="check">I Subscribed</button></div></div></div>

<script>
(function(){
  const qs = n => new URLSearchParams(location.search).get(n);
  const rawPair = qs('pair') || 'EURUSD';
  const tf = qs('tf') || '5s';
  const pairTitleEl = document.getElementById('pairTitle');
  const pairMetaEl = document.getElementById('pairMeta');
  const tfText = document.getElementById('tfText');
  const flag1Wrap = document.getElementById('flag1Wrap');
  const flag2Wrap = document.getElementById('flag2Wrap');
  const generateBtn = document.getElementById('generateBtn');
  const backBtn = document.getElementById('backBtn');
  const progressCircle = document.getElementById('progressCircle');
  const ringPercent = document.getElementById('ringPercent');
  const indicatorsList = document.getElementById('indicatorsList');
  const arrowOverlay = document.getElementById('arrowOverlay');
  const arrowUp = document.getElementById('arrowUp');
  const arrowDown = document.getElementById('arrowDown');
  const glowHalo = document.getElementById('glowHalo');
  const signalLabel = document.getElementById('signalLabel');
  const subModal = document.getElementById('subModal');

  function seeded(seedString){
    let seed = 0;
    for(let i=0;i<seedString.length;i++) seed = (seed*31 + seedString.charCodeAt(i)) % 1000000;
    return function(min,max){
      seed = (seed * 9301 + 49297) % 233280;
      const v = seed / 233280;
      return min + v*(max-min);
    };
  }
  function makeIndicators(seedStr){
    const r = seeded(seedStr);
    const indicators = {
      MACD: Number(r(-1.6,2.4).toFixed(2)),
      RSI: Math.round(r(30,88)),
      OBV_trend: Number(r(-1,1).toFixed(2)),
      EMA_diff: Number(r(-0.8,1.8).toFixed(2)),
      SAR_delta: Number(r(-0.6,0.9).toFixed(2)),
      Volatility: Number(r(0.6,2.6).toFixed(2)),
      VolumeStrength: Number(r(0.2,1.0).toFixed(2))
    };
    let score = 0;
    score += Math.max(0, indicators.MACD + 1) * 0.18;
    score += (Math.max(0, indicators.RSI - 40) / 50) * 0.18;
    score += ((indicators.OBV_trend + 1) / 2) * 0.15;
    score += (Math.max(0, indicators.EMA_diff + 0.8) / 2.6) * 0.14;
    score += (Math.max(0, indicators.SAR_delta + 0.6) / 1.5) * 0.12;
    const volScore = 1 - Math.abs(indicators.Volatility - 1.1) / 1.5;
    score += Math.max(0, volScore) * 0.12;
    score += indicators.VolumeStrength * 0.11;
    score = Math.max(0, Math.min(1, score / 1.05));
    const confidence = Math.round((0.79 + score * 0.17) * 100);
    return {indicators,score:Number((score*10).toFixed(2)),confidence};
  }

  function renderIndicatorChips(ind){
    indicatorsList.innerHTML = '';
    const mapping = [
      ['Parabolic SAR', ind.SAR_delta],
      ['On Balance Volume', ind.OBV_trend],
      ['MACD', ind.MACD],
      ['RSI', ind.RSI],
      ['EMA Cross', ind.EMA_diff],
      ['Volatility', ind.Volatility],
      ['Volume Strength', ind.VolumeStrength]
    ];
    mapping.forEach(([label,val])=>{
      const btn = document.createElement('button');
      btn.className = 'ind-chip';
      btn.innerText = label;
      btn.title = String(val);
      indicatorsList.appendChild(btn);
    });
  }

  function setRingPercent(pct){
    const radius = 56;
    const circumference = 2 * Math.PI * radius;
    progressCircle.setAttribute('stroke-dasharray', circumference.toFixed(3));
    const offset = Math.round(circumference * (1 - pct/100));
    progressCircle.style.transition = 'stroke-dashoffset 800ms cubic-bezier(.2,.9,.36,1)';
    progressCircle.style.strokeDashoffset = offset;
    ringPercent.textContent = pct + '%';
  }

  function decideSignal(ind){
    const scoreComposite = (ind.MACD * 1.3) + (ind.OBV_trend * 1.2) + (ind.EMA_diff * 1.0) + ((ind.RSI - 50) / 30);
    return scoreComposite >= 0 ? 'UP' : 'DOWN';
  }

  function showArrow(direction, confidence){
    arrowUp.style.display='none'; arrowDown.style.display='none';
    glowHalo.className='glow-halo'; signalLabel.className='signal-label';
    if(direction === 'UP'){ arrowUp.style.display='block'; glowHalo.classList.add('up','show'); signalLabel.classList.add('signal-up','show'); signalLabel.textContent = `Your signal is UP — ${confidence}%`; }
    else { arrowDown.style.display='block'; glowHalo.classList.add('down','show'); signalLabel.classList.add('signal-down','show'); signalLabel.textContent = `Your signal is DOWN — ${confidence}%`; }
    arrowOverlay.classList.add('show');
    setTimeout(()=>{ arrowOverlay.classList.remove('show'); glowHalo.className='glow-halo'; signalLabel.classList.remove('show'); }, 5000);
  }

  pairTitleEl.textContent = (rawPair.length===6) ? rawPair.slice(0,3)+' / '+rawPair.slice(3)+' (OTC)' : rawPair;
  tfText.textContent = tf;

  const initial = makeIndicators(rawPair+'::'+(new Date()).toISOString().slice(0,16));
  renderIndicatorChips(initial.indicators);
  setTimeout(()=> setRingPercent(initial.confidence), 120);

  generateBtn.addEventListener('click', ()=>{
    // show modal to non-admin (here this page is simpler: no admin toggle)
    subModal.style.display = 'flex';
    subModal.setAttribute('aria-hidden','false');
  });
  backBtn.addEventListener('click', ()=> window.location.href = 'dashboard.html');

})();
</script>
</body>
</html>
